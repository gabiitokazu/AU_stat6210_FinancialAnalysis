---
output: html_document
pagetitle: "Homework 2, Group 9: to the Client"
---

 ```{css, echo=FALSE}
     .disclosure{
     text-align: justify;
     margin-left: auto;
     margin-right: auto;
     font-style: italic;
     width: 80%;
     }

```

## Dear valued Client,
### Please find below our finalized report with your current options. Please contact us if you need anything else, we will be happy to assist you in this new journey!.
\

#### Best regards,
##### Ana Gabriela Itokazu, Jianfeng Zhang, and Takhellambam Bijoychandra Singh.

***
<div class="disclosure">

Portfolio developed for a homework activity during the class STAT 6210 - R Programming for Data Science (Auburn University, Fall 2020). The general idea is that the group works as a quantitative analysts for an investment bank, and we needed to present a Portfolio for our boss (Dr. Molinari, in this very real case) with a client's options. This document was produced in RMarkDown, and finalized in `r format(Sys.Date(), '%B %d, %Y')`. One can find more about this assignment [here](https://github.com/AU-R-Programming/HW2-9/blob/master/ToTheClient.Rmd).

</div>

***
<div style="text-align: justify">

# Financial Report
The five companies that were selected are listed below, each followed by its label, that is used to identify the stock in the databases.

- West Rock Packaging Solutions (WRK)
- Darden Restaurants Inc. (DRI)
- Mylan Pharmaceuticals (MYL)
- PepsiCo Inc. (PBCT)
- United Airlines (UAL)


The stocks considered for this report are listed in the S&P 500 (Standard & Poor's 500 Index), which incorporates the current 500 largest U.S. publicly traded companies. This was done not only based on the availability of the data, but also because this data base is a benchmark for financial analysis. For an optimized portfolio, we based our analysis in 5 randomly-sampled companies from the S&P 500, and simulated portfolios of different sizes (1, 2, and 3 companies), and with different options of weights for the said companies, in order to find the least risk.



</div>

# Required Library.

First of required libraries i.e. rvest, quantmod and tidyverse are called. 
```{r stock, echo=TRUE}
library(rvest)
library(quantmod)
library(tidyverse)
```

# Stock selection.

```{r random_sample, echo=FALSE}
url <- "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies"
SP500 <- url %>%
  xml2::read_html() %>%
  html_nodes(xpath='//*[@id="mw-content-text"]/div/table[1]') %>%
  html_table()
SP500 <- SP500[[1]]
Tix <- SP500$Symbol

set.seed(100)
stocks_names <- sample(Tix, 5)
```

Five stocks were selected randomly that download from this [link](https://en.wikipedia.org/wiki/List_of_S%26P_500_companies) i.e. `r stocks_names` where 

`r stocks_names[1]`=fORTIVE Corp, `r stocks_names[2]`= Zimmer Biomet Holdings, `r stocks_names[3]`=Oracle Corp., `r stocks_names[4]`=Citrix Systems, and `r stocks_names[5]`=Xilinx.


# Temporal Scale 

In this analysis, a  time span for last 3 years i.e. from  "2017-04-01" till "2020-04-01" were considered.
```{r time_span, echo=FALSE, include=FALSE}
#time span for last 3 years
three_year_ago <- seq(as.Date("2020-04-01"), length = 2, by = "-3 year")[2]
getSymbols(stocks_names, from = three_year_ago, to = as.Date("2020-04-01"))
```




# Compute returns

Here clcl() function is used to compute change in closing price.
For example, "AAPL" company has change in closing price( clcl) as given below
clcl= ((AAPL.Close at t+1 )-(AAPL.Close t))/(AAPL.Close at  t), where t= time step

```{r fetch_data, echo=TRUE}

FTV <- na.omit(ClCl(get(stocks_names[1]))) # Fortive Corp
ZBH <- na.omit(ClCl(get(stocks_names[2]))) # Zimmer Biomet Holdings Inc.
ORCL <- na.omit(ClCl(get(stocks_names[3]))) # Oracle Corporation
CTXS <- na.omit(ClCl(get(stocks_names[4]))) # Citrix Systems, Inc.
XLNX <- na.omit(ClCl(get(stocks_names[5]))) # Xilinx, Inc.

stocks_considered <- cbind(FTV, ZBH, ORCL, CTXS, XLNX)
colnames(stocks_considered) = c("FTV", "ZBH", "ORCL", "CTXS", "XLNX")

```

# Matrix 

 This first matrix has 10x7 dimensions as it considers 3 portfolio out of 5 giving a combination of C(5,3)=10 portfolios.
```{r stock4, echo=TRUE}
final=matrix(NA,10, 7)
colnames(final)=c(stocks_names,"Exp return","Risk")
```

The below code estimate weight,the daily expected return and risk considering  stocks out of 5 giving a combination of C(5,3)=10 portfolios.

```{r prepping_loop, echo=FALSE}
C <- 1e6
p <- c()

stocks <- data.frame("FTV" = double(0),
                     "ZBH" = double(0),
                     "ORCL" = double(0),
                     "CTXS" = double(0),
                     "XLNX" = double(0),
                     "ExpReturn" = double(0),
                     "Risk" = double(0)
)
```


```{r loop, echo=TRUE}

for (i in 1:3){
        # updates vector p
        p <- append(p,1) 
        #generates combinations (by3, by2, single)
        comb <- combn(1:ncol(stocks_considered), i)
        temp <- split(comb, rep(1:ncol(comb), each = nrow(comb)))
        
        # creates empty matrix for all combinations of stocks 
        summary <- matrix(nrow = ncol(comb), ncol = (ncol(stocks_considered)+2))
        colnames(summary) = c(stocks_names,"ExpReturn","Risk")
        
        # iterates for all combinations of stocks in each combination option
        for (j in 1:ncol(comb)) {
                # creates matrix based on the combinations in 'temp'
                x <- stocks_considered[,temp[[j]]] 
                # defines sigma and mu values
                sigma <- cov(x)
                mu <-sapply(x, mean)
                # Computes weight
                weight_calc <- (solve(sigma)%*%p)  / 
                        (as.numeric(t(p) %*% solve(sigma) %*% p))
                # Computes return
                return_calc <- t(weight_calc) %*% mu * C
                # Computes risk
                risk_calc <- t(weight_calc) %*% sigma %*% weight_calc * (C^2)
                
                # assigns the calculated weights to the respective columns
                summary[j,temp[[j]]] = c(t(weight_calc))
                # assigns the calculates returns and risks to the respective columns
                summary[j,6:7] = c(return_calc,risk_calc)
        }
        
        # replaces NA values with 0 
        summary <- replace_na(summary,0)
        # adds current 'summary' to the 'stocks' data.frame
        stocks <- rbind(stocks, summary)
}
```

Likewise, this loop will estimate weight,the daily expected return and risk considering 2 stocks out of 5 giving a combination of C(5,2)=10 portfolios. The procedure is indeed same as done above code.

Again, this loop will estimate weight, the daily expected return and risk considering 1 stocks out of 5 giving a combination of C(5,1)=5 is available. The procedure is indeed same as done above code.
 
 Here, *stocks* matrix showed the combine portfolios showing  with using stock size of 3,2 and 1 having a total of 25 portfolios.

The best portfolios with its weight of stocks, daily expected return as well as risk is provided.
```{r stock9, echo=TRUE}

min_risk <- which.min(stocks$Risk)
max_return <- which.max(stocks$ExpReturn)
best <- stocks[min_risk,]
```

Graphically, it is shown in the plot below. The red dotted showed best portfolio out of the 25 portfolios shown in black having minimum risk of `r best$Risk` and daily expected return of `r best$ExpReturn`. The weight for each stocks of *FTV*, *ZBH*, and *CTXS* are `r best$FTV`,`r best$ZBH`, and `r best$ORCL` respectively. So, the portfolio 2 is the best option one can invest considering the minimum risk.
```{r stock10, echo=TRUE}
min_risk <- which.min(stocks$Risk)
max_return <- which.max(stocks$ExpReturn)

stocks$col = "Options Analyzed"
min = which.min(stocks[,1]) # shows the minimum value (row)
stocks$col[min_risk] = "Lowest Risk"
stocks$col[max_return] = "Highest Return"
library(ggplot2)
ggplot(stocks, aes(x=Risk, y=ExpReturn, color = col )) + 
        geom_point() + 
        theme_test() +
        theme(legend.title = element_blank(), legend.position= c(0.80,0.2), 
              plot.title = element_text(hjust = 0.5)) +
        xlab("Portfolio Risk") + 
        ylab("Portfolio Expected Returns") +
        ggtitle("Your options")

```


