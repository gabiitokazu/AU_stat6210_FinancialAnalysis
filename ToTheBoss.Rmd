---
output: html_document
pagetitle: "Homework 2, Group 9: to the Boss"
---

 ```{css, echo=FALSE}
     .disclosure{
     text-align: justify;
     margin-left: auto;
     margin-right: auto;
     font-style: italic;
     width: 80%;
     }

```


## Dear Boss,
### Please find our finalized report below.
\

#### Best regards,
##### Ana Gabriela Itokazu, Jianfeng Zhang, and Takhellambam Bijoychandra Singh.


***
<div class="disclosure">

Portfolio developed for a homework activity during the class STAT 6210 - R Programming for Data Science (Auburn University, Fall 2020). The general idea is that the group works as a quantitative analysts for an investment bank, and we needed to present a Portfolio for our boss (Dr. Molinari, in this very real case) with the a client's options. This document was finalized in `r format(Sys.Date(), '%B %d, %Y')`. One can find more about this assignment [here](https://github.com/AU-R-Programming/HW2-9/blob/master/ToTheBoss.Rmd).

</div>


<div style="text-align: justify">

***
# Financial Report


# Required Library.

First of required libraries i.e. rvest, quantmod and tidyverse are called. 
```{r stock, echo=FALSE, include=FALSE}
library(rvest)
library(quantmod)
library(tidyverse)
```

# Stock selection.



```{r random_sample, echo=FALSE}
url <- "https://en.wikipedia.org/wiki/List_of_S%26P_500_companies"
SP500 <- url %>%
  xml2::read_html() %>%
  html_nodes(xpath='//*[@id="mw-content-text"]/div/table[1]') %>%
  html_table()
SP500 <- SP500[[1]]
Tix <- SP500$Symbol

set.seed(100)
stocks_names <- sample(Tix, 5)
```
Five stocks were selected randomly that download from this [link](https://en.wikipedia.org/wiki/List_of_S%26P_500_companies) i.e. `r stocks_names` where 

`r stocks_names[1]`=fORTIVE Corp, `r stocks_names[2]`= Zimmer Biomet Holdings, `r stocks_names[3]`=Oracle Corp., `r stocks_names[4]`=Citrix Systems, and `r stocks_names[5]`=Xilinx.

# Temporal Scale 

In this analysis, a  time span for last 3 years i.e. from  "2017-04-01" till "2020-04-01" were considered.
```{r time_span, echo=FALSE, include=FALSE}
#time span for last 3 years
three_year_ago <- seq(as.Date("2020-04-01"), length = 2, by = "-3 year")[2]
getSymbols(stocks_names, from = three_year_ago, to = as.Date("2020-04-01"))
```

# Compute returns

clcl() function is used to compute change in closing price.For example, "AAPL" company has change in closing price( clcl) as given below clcl= ((AAPL.Close at t+1 )-(AAPL.Close t))/(AAPL.Close at  t), where t= time step

```{r fetch_data, echo=FALSE}

FTV <- na.omit(ClCl(get(stocks_names[1]))) # Fortive Corp
ZBH <- na.omit(ClCl(get(stocks_names[2]))) # Zimmer Biomet Holdings Inc.
ORCL <- na.omit(ClCl(get(stocks_names[3]))) # Oracle Corporation
CTXS <- na.omit(ClCl(get(stocks_names[4]))) # Citrix Systems, Inc.
XLNX <- na.omit(ClCl(get(stocks_names[5]))) # Xilinx, Inc.

stocks_considered <- cbind(FTV, ZBH, ORCL, CTXS, XLNX)
colnames(stocks_considered) = c("FTV", "ZBH", "ORCL", "CTXS", "XLNX")

```

# Matrix 

```{r prepping_loop, echo=FALSE}
C <- 1e6
p <- c()

stocks <- data.frame("FTV" = double(0),
                     "ZBH" = double(0),
                     "ORCL" = double(0),
                     "CTXS" = double(0),
                     "XLNX" = double(0),
                     "ExpReturn" = double(0),
                     "Risk" = double(0)
)
```


A matrix with 10x7 dimensions is created to store the output of weight, expected daily return and risk for each portfolios.As it considers 3 portfolio out of 5 giving a combination of C(5,3)=10 portfolios.
```{r loop, echo=TRUE}

for (i in 1:3){
        # updates vector p
        p <- append(p,1) 
        #generates combinations (by3, by2, single)
        comb <- combn(1:ncol(stocks_considered), i)
        temp <- split(comb, rep(1:ncol(comb), each = nrow(comb)))
        
        # creates empty matrix for all combinations of stocks 
        summary <- matrix(nrow = ncol(comb), ncol = (ncol(stocks_considered)+2))
        colnames(summary) = c(stocks_names,"ExpReturn","Risk")
        
        # iterates for all combinations of stocks in each combination option
        for (j in 1:ncol(comb)) {
                # creates matrix based on the combinations in 'temp'
                x <- stocks_considered[,temp[[j]]] 
                # defines sigma and mu values
                sigma <- cov(x)
                mu <-sapply(x, mean)
                # Computes weight
                weight_calc <- (solve(sigma)%*%p)  / 
                        (as.numeric(t(p) %*% solve(sigma) %*% p))
                # Computes return
                return_calc <- t(weight_calc) %*% mu * C
                # Computes risk
                risk_calc <- t(weight_calc) %*% sigma %*% weight_calc * (C^2)
                
                # assigns the calculated weights to the respective columns
                summary[j,temp[[j]]] = c(t(weight_calc))
                # assigns the calculates returns and risks to the respective columns
                summary[j,6:7] = c(return_calc,risk_calc)
        }
        
        # replaces NA values with 0 
        summary <- replace_na(summary,0)
        # adds current 'summary' to the 'stocks' data.frame
        stocks <- rbind(stocks, summary)
}
```


Likewise, second matrix having 10x7 dimension is created for storing the weight, expected daily return and risk of each portfolios of C(5,2)=10.This is done as in the previous matrix.

Again, matrix with 5x1 dimensions is created for storing weight, the daily expected return and risk considering 1 stocks out of 5 giving a combination of C(5,1)=5 is available. The procedure is again same as done above code.

 Finally, *stock* matrix showed the combine portfolios showing  with using stock size of 3,2 and 1 having a total of 25 portfolios.


The best portfolios with its weight of stocks, daily expected return as well as risk is provided.
```{r stock9, echo=FALSE}
#choose the row showing minimum risk
min_risk <- which.min(stocks[,7])

# rounding the values upto 3 decimals
best <- stocks[min_risk,]
best
```

Graphically, it is shown in the plot below. The red dotted showed best portfolio out of the 25 portfolios shown in black having minimum risk of `r best[7]` and daily expected return of `r best[6]`. The weight for each stocks of *FTV*, *ZBH*, and *CTXS* are `r best[1]`,`r best[2]`, and `r best[4]` respectively. So, the portfolio 2 is the best option one can invest considering the minimum risk.
```{r stock10, echo=TRUE}
#plot of all portfolios
plot(stocks[-min_risk,7],stocks[-min_risk,6],pch=1,type = "p",  col = 1, 
     xlab = "Investment Daily Risk",
     ylab = "Investment Daily Expected Return", main="Stock Portfolios")
#addition of portfolio having smallest variance
points(best[7], best[6],pch = 1, col = 10, type = "p")
#add legends
legend("bottomright", c("Possible portfolio", "Min-Variance Portfolio"), col = c(1,10),
       lty = c(-2, -1), pch = c(1, 1))

```


